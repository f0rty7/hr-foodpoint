import{B as s,E as o,T as a,eb as l}from"./chunk-F2YS2TH7.js";import{c as n}from"./chunk-2VMXMS7J.js";var g=class i{constructor(e){this.router=e;this.checkExistingAuth()}API_BASE_URL="http://0.0.0.0:4000";currentUserSignal=a(null);isLoadingSignal=a(!1);errorSignal=a(null);currentUser=this.currentUserSignal.asReadonly();isLoading=this.isLoadingSignal.asReadonly();error=this.errorSignal.asReadonly();isAuthenticated=()=>!!this.currentUserSignal();checkExistingAuth(){let e=localStorage.getItem("auth_token");e&&this.verifyToken(e)}verifyToken(e){return n(this,null,function*(){try{console.log("Verifying token on page refresh...");let t=yield fetch(`${this.API_BASE_URL}/auth/me`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let r=yield t.json();console.log("Token verification successful, user data:",r),this.currentUserSignal.set({id:r.user.id,name:r.user.name,email:r.user.email,phone:r.user.phone})}else console.warn("Token verification failed with status:",t.status),localStorage.removeItem("auth_token"),this.currentUserSignal.set(null)}catch(t){console.warn("Token verification failed with error:",t),localStorage.removeItem("auth_token"),this.currentUserSignal.set(null)}})}signin(e){return n(this,null,function*(){this.isLoadingSignal.set(!0),this.errorSignal.set(null);try{let t=yield fetch(`${this.API_BASE_URL}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})}),r=yield t.json();return t.ok?(localStorage.setItem("auth_token",r.accessToken),this.currentUserSignal.set(r.user),this.router.navigate(["/home"]),!0):(this.errorSignal.set(r.message||"Login failed"),!1)}catch{return this.errorSignal.set("Network error. Please try again."),!1}finally{this.isLoadingSignal.set(!1)}})}signup(e){return n(this,null,function*(){this.isLoadingSignal.set(!0),this.errorSignal.set(null);try{let t=yield fetch(`${this.API_BASE_URL}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=yield t.json();return t.ok?(localStorage.setItem("auth_token",r.accessToken),this.currentUserSignal.set(r.user),this.router.navigate(["/home"]),!0):(this.errorSignal.set(r.message||"Registration failed"),!1)}catch{return this.errorSignal.set("Network error. Please try again."),!1}finally{this.isLoadingSignal.set(!1)}})}signout(){return n(this,null,function*(){try{let e=localStorage.getItem("auth_token");e&&(yield fetch(`${this.API_BASE_URL}/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${e}`}}))}catch(e){console.warn("Logout API call failed:",e)}finally{localStorage.removeItem("auth_token"),this.currentUserSignal.set(null),this.router.navigate(["/auth/signin"])}})}clearError(){this.errorSignal.set(null)}getAuthToken(){return localStorage.getItem("auth_token")}static \u0275fac=function(t){return new(t||i)(o(l))};static \u0275prov=s({token:i,factory:i.\u0275fac,providedIn:"root"})};export{g as a};
